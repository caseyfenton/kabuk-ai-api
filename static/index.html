<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HafH - AI Concierge Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .demo-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .agent-status {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .agent-status.active {
            background: #f0fdf4;
            border-left-color: #10b981;
        }

        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .property-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .property-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .property-card.highlight {
            border: 3px solid #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .property-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .property-content {
            padding: 20px;
        }

        .property-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }

        .property-location {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .property-description {
            color: #4b5563;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .property-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tag {
            background: #f3f4f6;
            color: #4b5563;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .property-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }

        .book-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .book-btn:hover {
            background: #5568d3;
        }

        .context-info {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #4b5563;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        #elevenlabs-widget {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè° HafH AI Concierge</h1>
            <p>Voice-Controlled Property Discovery Demo</p>
        </div>

        <div class="demo-section">
            <div id="agent-status" class="agent-status">
                <strong>Agent Status:</strong> Initializing...
            </div>

            <div id="context-info" class="context-info" style="display: none;">
                <strong>üéØ Conversation Context:</strong> <span id="context-text"></span>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="testShowProperties()">Test: Show Properties</button>
                <button class="btn btn-secondary" onclick="testHighlight()">Test: Highlight First</button>
                <button class="btn btn-secondary" onclick="clearProperties()">Clear</button>
            </div>

            <div id="properties-container"></div>

            <!-- ElevenLabs widget will load here -->
            <div id="elevenlabs-widget"></div>
        </div>
    </div>

    <script type="module">
        // Sample property data from HafH database
        const SAMPLE_PROPERTIES = [
            {
                pid: "12345",
                name: "Mountain Onsen Retreat",
                prefecture: "Nagano",
                country: "JP",
                ts_text: "Peaceful mountain retreat with natural hot springs",
                ts_stay_text: "Experience traditional Japanese hospitality in our mountain onsen resort. Surrounded by pristine nature with breathtaking views of the Japanese Alps.",
                tags: ["Hot Springs", "Mountain", "Traditional"],
                coins: 450,
                images: []
            },
            {
                pid: "23456",
                name: "Kyoto Zen Garden Stay",
                prefecture: "Kyoto",
                country: "JP",
                ts_text: "Traditional machiya house in historic Gion",
                ts_stay_text: "Sleep in a beautifully restored traditional townhouse steps from Kyoto's most famous temples and geisha district.",
                tags: ["Traditional", "Cultural", "City Center"],
                coins: 380,
                images: []
            },
            {
                pid: "34567",
                name: "Hokkaido Snow Lodge",
                prefecture: "Hokkaido",
                country: "JP",
                ts_text: "Ski-in ski-out lodge with amazing powder",
                ts_stay_text: "Perfect for winter sports enthusiasts. Direct access to Niseko's world-famous powder snow and apr√®s-ski dining.",
                tags: ["Skiing", "Winter", "Adventure"],
                coins: 520,
                images: []
            }
        ];

        // Global state
        let currentProperties = [];

        // UI Update Functions
        function renderProperties(properties) {
            currentProperties = properties;
            const container = document.getElementById('properties-container');

            if (!properties || properties.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 40px;">No properties to display. Agent will show properties during conversation.</p>';
                return;
            }

            container.innerHTML = `
                <div class="properties-grid">
                    ${properties.map(prop => `
                        <div class="property-card" data-property="${prop.pid}">
                            <div class="property-image">${getPropertyEmoji(prop)}</div>
                            <div class="property-content">
                                <div class="property-name">${prop.name}</div>
                                <div class="property-location">
                                    üìç ${prop.prefecture}, ${prop.country}
                                </div>
                                <div class="property-description">
                                    ${prop.ts_stay_text || prop.ts_text}
                                </div>
                                <div class="property-tags">
                                    ${(prop.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                                <div class="property-footer">
                                    <div style="font-weight: 600; color: #667eea;">
                                        ${prop.coins} coins/night
                                    </div>
                                    <button class="book-btn" onclick="bookProperty('${prop.pid}')">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function getPropertyEmoji(property) {
            if (property.tags?.includes('Hot Springs')) return '‚ô®Ô∏è';
            if (property.tags?.includes('Skiing')) return '‚õ∑Ô∏è';
            if (property.tags?.includes('Traditional')) return 'üèØ';
            if (property.tags?.includes('Beach')) return 'üèñÔ∏è';
            return 'üè°';
        }

        function highlightProperty(propertyId) {
            // Remove existing highlights
            document.querySelectorAll('.property-card').forEach(card => {
                card.classList.remove('highlight');
            });

            // Add highlight to specified property
            const card = document.querySelector(`[data-property="${propertyId}"]`);
            if (card) {
                card.classList.add('highlight');
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return `Highlighted property ${propertyId}`;
            }
            return `Property ${propertyId} not found`;
        }

        function updateContext(text) {
            const contextInfo = document.getElementById('context-info');
            const contextText = document.getElementById('context-text');
            contextInfo.style.display = 'block';
            contextText.textContent = text;
        }

        function updateAgentStatus(status, isActive = false) {
            const statusEl = document.getElementById('agent-status');
            statusEl.innerHTML = `<strong>Agent Status:</strong> ${status}`;
            statusEl.className = `agent-status ${isActive ? 'active' : ''}`;
        }

        // Client Tools for ElevenLabs Agent
        const clientTools = {
            showProperties: async ({query, properties}) => {
                console.log('üéØ Agent called showProperties:', {query, properties});

                // Update context
                updateContext(`Agent searching for: "${query}"`);

                // If properties provided, use them; otherwise use samples
                const propertiesToShow = properties || SAMPLE_PROPERTIES;

                // Render properties
                renderProperties(propertiesToShow);

                return {
                    success: true,
                    message: `Showing ${propertiesToShow.length} properties for "${query}"`,
                    count: propertiesToShow.length
                };
            },

            highlightProperty: async ({propertyId, reason}) => {
                console.log('‚ú® Agent highlighting property:', propertyId, reason);

                const result = highlightProperty(propertyId);

                if (reason) {
                    updateContext(`Agent highlighting: ${reason}`);
                }

                return {
                    success: true,
                    message: result
                };
            },

            openPropertyDetail: async ({propertyId}) => {
                console.log('üìñ Agent opening property detail:', propertyId);

                const property = currentProperties.find(p => p.pid === propertyId);
                if (property) {
                    alert(`Property Detail:\n\n${property.name}\n${property.prefecture}, ${property.country}\n\n${property.ts_stay_text}\n\nPrice: ${property.coins} coins/night`);
                    return {success: true, message: 'Opened property detail modal'};
                }

                return {success: false, message: 'Property not found'};
            },

            clearDisplay: async () => {
                console.log('üßπ Agent clearing display');
                currentProperties = [];
                document.getElementById('properties-container').innerHTML = '';
                document.getElementById('context-info').style.display = 'none';
                return {success: true, message: 'Display cleared'};
            }
        };

        // Test Functions (for manual testing without agent)
        window.testShowProperties = () => {
            clientTools.showProperties({
                query: "mountain hot springs",
                properties: SAMPLE_PROPERTIES
            });
        };

        window.testHighlight = () => {
            if (currentProperties.length > 0) {
                clientTools.highlightProperty({
                    propertyId: currentProperties[0].pid,
                    reason: "This property has the best reviews for hot springs"
                });
            }
        };

        window.clearProperties = () => {
            clientTools.clearDisplay();
        };

        window.bookProperty = (propertyId) => {
            const property = currentProperties.find(p => p.pid === propertyId);
            if (property) {
                alert(`Booking flow would open for:\n${property.name}\n\nIn production, this would redirect to:\nhttps://hafh.com/properties/${propertyId}`);
            }
        };

        // Initialize
        updateAgentStatus('Demo mode - Test buttons active. ElevenLabs agent not connected yet.', false);
        renderProperties([]); // Start with empty state

        console.log('‚úÖ HafH Client Tools Demo Ready');
        console.log('üìã Available Client Tools:', Object.keys(clientTools));
        console.log('üß™ Use test buttons to simulate agent interaction');

        // TODO: Uncomment when ElevenLabs agent ID is available
        /*
        import { Conversation } from 'https://unpkg.com/@elevenlabs/client@latest';

        (async () => {
            try {
                updateAgentStatus('Connecting to ElevenLabs agent...', false);

                const conversation = await Conversation.startSession({
                    agentId: 'YOUR_AGENT_ID_HERE', // Replace with actual agent ID
                    clientTools: clientTools,
                    onConnect: () => {
                        updateAgentStatus('Agent connected - Start talking!', true);
                        console.log('‚úÖ Connected to Hana agent');
                    },
                    onDisconnect: () => {
                        updateAgentStatus('Agent disconnected', false);
                    },
                    onMessage: (message) => {
                        console.log('üí¨ Agent message:', message);
                    },
                    onError: (error) => {
                        console.error('‚ùå Error:', error);
                        updateAgentStatus(`Error: ${error.message}`, false);
                    }
                });

                console.log('üéôÔ∏è Conversation started');
            } catch (error) {
                console.error('‚ùå Failed to start conversation:', error);
                updateAgentStatus(`Failed to connect: ${error.message}`, false);
            }
        })();
        */
    </script>
</body>
</html>
